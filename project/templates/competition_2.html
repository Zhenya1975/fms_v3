<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">


   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <style type="text/css">
     a:hover {
      cursor:pointer;
     }
    </style>
    <title>{{ competition_data.competition_name }}</title>
</head>
<body>
<div class="container-fluid" style="margin-top: 10px">
    <div class="row">
        <div class="col">

            <!-- Это начало Nav Bar-->
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <a class="navbar-brand" href="#">Fights Management System</a>


<!--                  <div class="collapse navbar-collapse" id="navbarSupportedContent">-->
                <div id="navbarSupportedContent">
                    <ul class="navbar-nav">
                          <li class="nav-item">
                            {#<a class="nav-link" href="{{url_for('index')}}">Главная</a>#}
                          </li>

                          <li class="nav-item">
                            {#<a class="nav-link" href="{{url_for('competitions')}}">Соревнования</a>#}
                          </li>

                          <li class="nav-item">
                              {#<a class="nav-link" href="{{url_for('participants')}}">Участники</a>#}
                          </li>

                          <li class="nav-item">
                            <a class="nav-link" href="{{url_for('home.competitions')}}">Соревнования</a>
                          </li>

                    </ul>
                </div>
        </nav>
<!-- Это конец Nav Bar-->

            {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                    <ul style="padding-left: 0">
                        {% for category, message in messages %}
                        <div class="alert {{category}} alert-dismissible fade show" role="alert">
                            <li style="list-style-type: none;">{{ message }}</li>
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        {% endfor %}
                    </ul>
                    {% endif %}
                {% endwith %}


        <p><a href="{{url_for('home.competitions')}}">Список соревнований</a></p>
{#                <p></p>#}
                <h3>{{ competition_data.competition_name }}</h3>

                <ul class="nav nav-tabs">
                    <li class="nav-item"><a class="nav-link" href="#competition_general_info" data-toggle="tab">Общая информация</a></li>
                    <li class="nav-item"><a class="nav-link" href="#registrations_tab" data-toggle="tab">Регистрации</a></li>
                    <li class="nav-item"><a class="nav-link" href="#competition_settings" data-toggle="tab">Настройки</a></li>
                </ul>

                <div class="tab-content" id="tabs">
                    <div class="tab-pane" id="competition_general_info">
                        <div style="margin-top: 10px"> <!-- div формы общие сведения о соревновании -->
                            <form method="POST" action="{{ url_for('home.competition_page', competition_id = competition_data.competition_id, active_tab_name = 1) }}">
                                {{ form_general_info.csrf_token }}
                                    <div class="form-group">
                                        {{ form_general_info.competition_name_form.label }}
                                        {{ form_general_info.competition_name_form (class ='form-control', value = competition_data.competition_name)}}
                                    <br>
                                          {% for error in form_general_info.competition_name_form.errors %}
                                            <span style="color: red;">[{{ error }}]</span>
                                          {% endfor %}
                                    </div>

                                    <div class="form-group">
                                        {{ form_general_info.competition_date_start.label }}
                                        {{ form_general_info.competition_date_start (class ='form-control', type="date", value = competition_data.competition_date_start)}}
                                    <br>
                                          {% for error in form_general_info.competition_date_start.errors %}
                                            <span style="color: red;">[{{ error }}]</span>
                                          {% endfor %}
                                    </div>

                                    <div class="form-group">
                                        {{ form_general_info.competition_date_finish.label }}
                                        {{ form_general_info.competition_date_finish (class ='form-control', type="date", value = competition_data.competition_date_finish)}}
                                    <br>
                                          {% for error in form_general_info.competition_date_start.errors %}
                                            <span style="color: red;">[{{ error }}]</span>
                                          {% endfor %}
                                    </div>

                                     <div class="form-group">
                                        {{ form_general_info.competition_city.label }}
                                        {{ form_general_info.competition_city (class ='form-control', type="text", value = competition_data.competition_city)}}
                                    <br>
                                          {% for error in form_general_info.competition_date_start.errors %}
                                            <span style="color: red;">[{{ error }}]</span>
                                          {% endfor %}
                                    </div>


                                     {{ form_general_info.submit (class ='btn btn-primary')}}


                              </form>
                        </div> <!-- конец div формы общие сведения о соревновании -->
                    </div>

                    <div class="tab-pane" id="registrations_tab">
                        <p></p>

                            <div>
                            <div>
{#                            <form id="select_fighter_form" method="POST" action="{{ url_for('home.registration_new_2', competition_id = competition_data.competition_id)}}">#}
                                    <select class="my-select selectpicker w-50" id="select_reg" data-live-search="true" title="Выберете участника из списка" name="fighter_pick">
                                      {% for participant in participants_data_for_selection %}
                                        <option value={{ participant.participant_id }}>{{ participant.participant_first_name }} {{ participant.participant_last_name }}</option>

                                       {% endfor %}
                                    </select>

                                <p></p>
                            <div>
                                <button type="button" data-id={{ competition_data.competition_id }} class="btn btn-primary select_new_reg">Выбрать</button>
                            </div>

{#                            </form>#}

                                <p></p>


                            <table id="registration_table" class="table table-striped table-bordered" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>№</th>
                                            <th>ФИО</th>
                                            <th>Вес, кг</th>
                                            <th>Весовая категория</th>
                                            <th>Возраст</th>
                                            <th>Возрастная категория</th>
                                            <th></th>


                                        </tr>
                                    </thead>
                                    <tbody>
                                    {% for reg in regs %}
                                        <tr>
                                            <td>{{ loop.index }} </td>
                                            <td>
                                                <a class="edit_reg" data-id={{ reg.reg_id }}>
                                                    {{ reg.registration_participant.participant_last_name }} {{ reg.registration_participant.participant_first_name}}
                                                </a>
                                            </td>
                                            <td>
                                                {{ reg.weight_value }}
                                            </td>
                                            <td>
{#                                                {{ reg.weight_categories.weight_category_name }}#}
                                            </td>
                                            <td>
{#                                                {{ reg.fighter_registration_age }}#}
                                            </td>
                                            <td>
{#                                                {{ reg.age_categories.age_category_name }}#}
                                            </td>

                                            <td>
                                                <button type="button" class="btn btn-light"><span><i class="fa fa-trash-o fa-2x delete_reg" aria-hidden="true" data-id={{ reg.reg_id }}></i></span></button>
                                            </td>


                                        </tr>
                                    {% endfor %}


                                </table>

                        </div>


                    </div>

                    <div class="tab-pane" id="competition_settings">
                    </div>


                </div>

        <div class="modal fade" id="registration_delete_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                      <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                          <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel">Удаление регистрации</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                          </div>

                                          <div class="modal-body">

                                          </div>

                                </div>
                      </div>
        </div>

        <div class="modal fade" id="new_reg_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                      <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                  <div class="modal-header">
                                        <h5 class="modal-title">Регистрация участника соревнований</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                  </div>

                                  <div class="modal-body">
                                  </div>

                            </div>
                      </div>
        </div>









        </div>
    </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>

<script>
    data_dict = {{ data | tojson }}
    $(document).ready(function(){
        var active_tab = data_dict['active_tab_pass'];
        activaTab(active_tab);
        function activaTab(tab){
          $('.nav-tabs a[href="#' + tab + '"]').tab('show');
        };



    $('.select_new_reg').click(function() {
        var participant_id = parseInt($('#select_reg').val());
        var competition_id = parseInt($(this).data('id'));
        if (parseInt(participant_id) > 0) {
            console.log("participant_id: ", participant_id, ". competition_id: ", competition_id)
           $.ajax({
                 url: '/new_reg_ajaxfile',
                 type: 'post',
                 data: {competition_id:competition_id, participant_id:participant_id},
                 success: function(data){

                    $('.modal-body').html(data);
                    $('.modal-body').append(data.htmlresponse);
                    $('#new_reg_modal').modal('show');
                }
             });
        } else {
           alert("Выберете спортсмена!");
        }

        {#console.log('participant_id ', participant_id)#}

    });

    $('.delete_reg').click(function(){
            var reg_id = $(this).data('id');
            // console.log('нажата кнопка удаления', reg_id)

             $.ajax({
                 url: '/delete_reg_ajaxfile',
                 type: 'post',
                 data: {reg_id:reg_id},
                 success: function(data){

                    $('.modal-body').html(data);
                    $('.modal-body').append(data.htmlresponse);
                    $('#registration_delete_modal').modal('show');
                }
             });
            });

    });
</script>
</body>
</html>